<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - Menu Restoran</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f7fa;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    .note {
      background: #e8f4fc;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 24px;
      font-size: 14px;
    }
    h2 {
      margin-top: 30px;
      padding-bottom: 6px;
      border-bottom: 2px solid #3498db;
      color: #2980b9;
    }
    .form-group {
      margin-bottom: 18px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #2c3e50;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 15px;
    }
    textarea {
      height: 60px;
      resize: vertical;
    }
    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 8px;
    }
    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
    }
    .btn:hover {
      background: #2980b9;
    }
    .btn-remove {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 3px;
      float: right;
    }
    .section-block {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #3498db;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .menu-item {
      background: #f9f9f9;
      padding: 12px;
      margin: 12px 0;
      border-radius: 6px;
      position: relative;
    }
    .array-controls {
      margin-top: 12px;
    }
    
    /* New styles for upload feature */
    .upload-section {
      background: #e8f4fc;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }
    .file-input-container {
      position: relative;
      display: inline-block;
      margin: 10px 0;
    }
    .file-input-container input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    .file-input-label {
      display: inline-block;
      padding: 10px 20px;
      background: #3498db;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .file-input-label:hover {
      background: #2980b9;
    }
    .file-name {
      margin-top: 8px;
      font-style: italic;
      color: #2c3e50;
    }
    .status-message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      display: none;
    }
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    .config-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    .btn-secondary {
      background: #95a5a6;
    }
    .btn-secondary:hover {
      background: #7f8c8d;
    }
  </style>
</head>
<body>

  <h1>üçΩÔ∏è Admin Panel - Konfigurasi Menu Restoran</h1>
  
  <!-- UPLOAD SECTION -->
  <div class="upload-section">
    <h2>üì§ Unggah Konfigurasi</h2>
    <p>Unggah file <code>config.js</code> yang sudah ada untuk mengedit konfigurasi Anda</p>
    
    <div class="file-input-container">
      <div class="file-input-label">Pilih File config.js</div>
      <input type="file" id="configFile" accept=".js,.json">
    </div>
    <div class="file-name" id="fileName">Belum ada file dipilih</div>
    
    <div class="status-message" id="uploadStatus"></div>
    
    <div class="config-actions">
      <button class="btn" onclick="loadDefaultConfig()">Gunakan Template Default</button>
      <button class="btn btn-secondary" onclick="resetForm()">Reset Formulir</button>
    </div>
  </div>
  
  <div class="note">
    <strong>Catatan:</strong> Pastikan semua gambar (logo, menu, dekorasi) sudah di-upload ke folder <code>/img/</code>. 
    Di form ini, cukup masukkan <strong>nama file lengkap</strong> (misal: <code>logo.png</code>, <code>nasi-goreng.jpg</code>).
  </div>

  <!-- HEADER -->
  <h2>1. Header</h2>
  <div class="form-group">
    <label>Judul Restoran</label>
    <div class="radio-group">
      <div class="radio-option">
        <input type="radio" id="headerText" name="headerType" value="text" checked>
        <label for="headerText">Teks</label>
      </div>
      <div class="radio-option">
        <input type="radio" id="headerLogo" name="headerType" value="logo">
        <label for="headerLogo">Logo (file)</label>
      </div>
    </div>
  </div>

  <div class="form-group" id="textHeaderGroup">
    <label for="headerTextValue">Teks Judul</label>
    <input type="text" id="headerTextValue" value="Warung Nusantara">
  </div>

  <div class="form-group" id="logoHeaderGroup" style="display:none;">
    <label for="headerLogoFile">Nama File Logo (di folder /img/)</label>
    <input type="text" id="headerLogoFile" placeholder="logo.png">
  </div>

  <!-- TAGLINE -->
  <h2>2. Tagline</h2>
  <div class="form-group">
    <label for="tagline">Tagline Restoran</label>
    <textarea id="tagline">Nikmati cita rasa autentik dari seluruh Indonesia!</textarea>
  </div>

  <!-- SECTIONS (KATEGORI + MENU) -->
  <h2>3. Menu (dikelompokkan per Kategori)</h2>
  <div id="sectionsContainer"></div>
  <button type="button" class="btn" onclick="addSection()">+ Tambah Kategori</button>

  <!-- EXTRA IMAGES -->
  <h2>4. Gambar Tambahan (Desain)</h2>
  <div id="extraImagesContainer"></div>
  <button type="button" class="btn" onclick="addExtraImage()">+ Tambah Gambar</button>

  <!-- CONTACT -->
  <h2>5. Kontak & Lokasi</h2>
  <div class="form-group">
    <label for="address">Alamat Lengkap</label>
    <textarea id="address">Jl. Raya Kuliner No. 45, Jakarta Selatan</textarea>
  </div>
  <div class="form-group">
    <label for="whatsapp">Nomor WhatsApp (format: +628...)</label>
    <input type="text" id="whatsapp" value="+6281234567890">
  </div>

  <!-- SOCIAL MEDIA -->
  <h2>6. Media Sosial</h2>
  <div class="form-group">
    <label for="ig">Instagram URL</label>
    <input type="text" id="ig" value="https://instagram.com/warungnusantara">
  </div>
  <div class="form-group">
    <label for="fb">Facebook URL</label>
    <input type="text" id="fb" value="https://facebook.com/warungnusantara">
  </div>
  <div class="form-group">
    <label for="yt">YouTube URL</label>
    <input type="text" id="yt" value="">
  </div>
  <div class="form-group">
    <label for="tw">Twitter/X URL</label>
    <input type="text" id="tw" value="https://x.com/warungnusantara">
  </div>

  <!-- GENERATE BUTTON -->
  <div style="text-align: center; margin-top: 30px;">
    <button class="btn" onclick="generateConfig()">üíæ Simpan & Generate config.js</button>
  </div>

  <script>
    // Utility: buat elemen DOM
    function el(tag, props = {}, children = []) {
      const e = document.createElement(tag);
      Object.assign(e, props);
      children.forEach(child => e.appendChild(child));
      return e;
    }

    // Toggle header input
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input[name="headerType"]').forEach(radio => {
        radio.addEventListener('change', () => {
          const isText = document.getElementById('headerText').checked;
          document.getElementById('textHeaderGroup').style.display = isText ? 'block' : 'none';
          document.getElementById('logoHeaderGroup').style.display = isText ? 'none' : 'block';
        });
      });

      // Isi awal
      addSection('Makanan Utama', 'makanan-utama');
      addSection('Minuman Segar', 'minuman');
      addExtraImage('bg-pattern.png');
      addExtraImage('divider-floral.png');
      
      // Set up file upload
      document.getElementById('configFile').addEventListener('change', handleFileSelect);
    });

    // --- FILE UPLOAD HANDLING ---
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const fileName = document.getElementById('fileName');
      fileName.textContent = file.name;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          let configData;
          
          // Handle both JS and JSON files
          if (file.name.endsWith('.js')) {
            // Extract JSON from JS file
            const jsContent = e.target.result;
            // Find the JSON part between { and }
            const jsonMatch = jsContent.match(/(\{[\s\S]*\})/);
            if (jsonMatch) {
              configData = JSON.parse(jsonMatch[1]);
            } else {
              throw new Error('File JS tidak mengandung konfigurasi yang valid');
            }
          } else {
            // For JSON files
            configData = JSON.parse(e.target.result);
          }
          
          // Populate form with loaded config
          populateForm(configData);
          showStatus('Konfigurasi berhasil dimuat!', 'success');
        } catch (error) {
          console.error('Error parsing config file:', error);
          showStatus('Gagal memuat konfigurasi: ' + error.message, 'error');
        }
      };
      reader.readAsText(file);
    }
    
    function showStatus(message, type) {
      const statusEl = document.getElementById('uploadStatus');
      statusEl.textContent = message;
      statusEl.className = `status-message status-${type}`;
    }
    
    function populateForm(config) {
      // Reset all sections first
      resetSections();
      resetExtraImages();
      
      // Header
      if (config.header) {
        if (config.header.type === 'logo') {
          document.getElementById('headerLogo').checked = true;
          document.getElementById('logoHeaderGroup').style.display = 'block';
          document.getElementById('textHeaderGroup').style.display = 'none';
          document.getElementById('headerLogoFile').value = config.header.logoFilename || '';
        } else {
          document.getElementById('headerText').checked = true;
          document.getElementById('textHeaderGroup').style.display = 'block';
          document.getElementById('logoHeaderGroup').style.display = 'none';
          document.getElementById('headerTextValue').value = config.header.text || 'Warung Nusantara';
        }
      }
      
      // Tagline
      if (config.tagline) {
        document.getElementById('tagline').value = config.tagline;
      }
      
      // Sections
      if (config.sections && Array.isArray(config.sections)) {
        config.sections.forEach(section => {
          addSection(section.name, section.id);
          const sectionDiv = document.querySelectorAll('#sectionsContainer .section-block')[document.querySelectorAll('#sectionsContainer .section-block').length - 1];
          
          if (section.items && Array.isArray(section.items)) {
            section.items.forEach(item => {
              addMenuItemInSection(sectionDiv, item);
            });
          }
        });
      }
      
      // Extra Images
      if (config.extraImages && Array.isArray(config.extraImages)) {
        config.extraImages.forEach(img => {
          addExtraImage(img);
        });
      }
      
      // Contact
      if (config.contact) {
        document.getElementById('address').value = config.contact.address || '';
        document.getElementById('whatsapp').value = config.contact.whatsapp || '';
      }
      
      // Social Media
      if (config.socialMedia) {
        document.getElementById('ig').value = config.socialMedia.instagram || '';
        document.getElementById('fb').value = config.socialMedia.facebook || '';
        document.getElementById('yt').value = config.socialMedia.youtube || '';
        document.getElementById('tw').value = config.socialMedia.twitter || '';
      }
    }
    
    function resetSections() {
      const container = document.getElementById('sectionsContainer');
      container.innerHTML = '';
    }
    
    function resetExtraImages() {
      const container = document.getElementById('extraImagesContainer');
      container.innerHTML = '';
    }
    
    function resetForm() {
      if (confirm('Apakah Anda yakin ingin mereset formulir? Semua perubahan akan hilang.')) {
        // Reset header
        document.getElementById('headerText').checked = true;
        document.getElementById('textHeaderGroup').style.display = 'block';
        document.getElementById('logoHeaderGroup').style.display = 'none';
        document.getElementById('headerTextValue').value = 'Warung Nusantara';
        document.getElementById('headerLogoFile').value = '';
        
        // Reset tagline
        document.getElementById('tagline').value = 'Nikmati cita rasa autentik dari seluruh Indonesia!';
        
        // Reset sections
        resetSections();
        addSection('Makanan Utama', 'makanan-utama');
        addSection('Minuman Segar', 'minuman');
        
        // Reset extra images
        resetExtraImages();
        addExtraImage('bg-pattern.png');
        addExtraImage('divider-floral.png');
        
        // Reset contact
        document.getElementById('address').value = 'Jl. Raya Kuliner No. 45, Jakarta Selatan';
        document.getElementById('whatsapp').value = '+6281234567890';
        
        // Reset social media
        document.getElementById('ig').value = 'https://instagram.com/warungnusantara';
        document.getElementById('fb').value = 'https://facebook.com/warungnusantara';
        document.getElementById('yt').value = '';
        document.getElementById('tw').value = 'https://x.com/warungnusantara';
        
        // Reset file input
        document.getElementById('configFile').value = '';
        document.getElementById('fileName').textContent = 'Belum ada file dipilih';
        document.getElementById('uploadStatus').className = 'status-message';
        
        showStatus('Formulir telah direset ke nilai default', 'success');
      }
    }
    
    function loadDefaultConfig() {
      // Create a default config object
      const defaultConfig = {
        header: {
          type: 'text',
          text: 'Warung Nusantara',
          logoFilename: ''
        },
        tagline: 'Nikmati cita rasa autentik dari seluruh Indonesia!',
        sections: [
          {
            id: 'makanan-utama',
            name: 'Makanan Utama',
            items: [
              {
                id: 'nasi-goreng-spesial',
                name: 'Nasi Goreng Spesial',
                description: 'Nasi goreng dengan telur, ayam, udang, dan sayuran segar.',
                imageFilename: 'nasi-goreng.jpg',
                price: 25000
              }
            ]
          },
          {
            id: 'minuman',
            name: 'Minuman Segar',
            items: [
              {
                id: 'es-teh-manis',
                name: 'Es Teh Manis',
                description: 'Teh manis dingin yang menyegarkan tenggorokan.',
                imageFilename: 'es-teh.jpg',
                price: 5000
              }
            ]
          }
        ],
        extraImages: ['bg-pattern.png', 'divider-floral.png'],
        contact: {
          address: 'Jl. Raya Kuliner No. 45, Jakarta Selatan',
          whatsapp: '+6281234567890'
        },
        socialMedia: {
          instagram: 'https://instagram.com/warungnusantara',
          facebook: 'https://facebook.com/warungnusantara',
          youtube: '',
          twitter: 'https://x.com/warungnusantara'
        }
      };
      
      populateForm(defaultConfig);
      showStatus('Template default telah dimuat', 'success');
    }

    // --- SECTIONS (KATEGORI + MENU ITEM) ---
    function addMenuItemInSection(sectionDiv, itemData = null) {
      const itemsContainer = sectionDiv.querySelector('.menu-items');
      const itemDiv = el('div', { className: 'menu-item' }, [
        el('input', { 
          type: 'text', 
          placeholder: 'Nama Menu',
          value: itemData ? itemData.name : ''
        }),
        el('textarea', { 
          placeholder: 'Deskripsi',
          innerText: itemData ? itemData.description : ''
        }),
        el('input', { 
          type: 'text', 
          placeholder: 'Nama File Gambar (di /img/)',
          value: itemData ? itemData.imageFilename : ''
        }),
        el('input', { 
          type: 'number', 
          placeholder: 'Harga (angka saja)', 
          min: '0',
          value: itemData ? itemData.price : ''
        }),
        el('button', {
          className: 'btn-remove',
          textContent: '√ó',
          onclick: () => itemsContainer.removeChild(itemDiv)
        })
      ]);
      itemsContainer.appendChild(itemDiv);
    }

    function addSection(name = '', id = '') {
      const container = document.getElementById('sectionsContainer');
      const autoId = id || (name ? name.toLowerCase().replace(/\s+/g, '-') : 'section-' + Date.now());

      const sectionDiv = el('div', { className: 'section-block' }, [
        el('strong', { textContent: 'Kategori' }),
        el('input', {
          type: 'text',
          placeholder: 'ID unik (misal: makanan-utama)',
          value: autoId,
          style: 'margin-top: 6px; width: 100%;'
        }),
        el('input', {
          type: 'text',
          placeholder: 'Nama Kategori (ditampilkan)',
          value: name,
          style: 'margin-top: 6px; width: 100%;'
        }),

        el('div', { className: 'menu-items', style: 'margin: 16px 0;' }),

        el('div', { className: 'array-controls' }, [
          el('button', {
            type: 'button',
            className: 'btn',
            style: 'padding: 6px 12px; font-size: 14px; margin-right: 8px;',
            textContent: '+ Tambah Menu',
            onclick: () => addMenuItemInSection(sectionDiv)
          }),
          el('button', {
            type: 'button',
            className: 'btn-remove',
            style: 'float: none; background: #e67e22;',
            textContent: '√ó Hapus Kategori',
            onclick: () => container.removeChild(sectionDiv)
          })
        ])
      ]);

      container.appendChild(sectionDiv);

      // Isi contoh menu jika kategori default dan tidak ada data yang dimuat
      if (!name && !id) {
        // Add empty menu item for new sections
        addMenuItemInSection(sectionDiv);
      }
    }

    // --- EXTRA IMAGES ---
    function addExtraImage(filename = '') {
      const container = document.getElementById('extraImagesContainer');
      const itemDiv = el('div', { style: 'margin: 8px 0;' }, [
        el('input', {
          type: 'text',
          placeholder: 'Nama file gambar (di /img/)',
          value: filename,
          style: 'width: calc(100% - 40px);'
        }),
        el('button', {
          className: 'btn-remove',
          textContent: '√ó',
          style: 'float: none; margin-left: 8px;',
          onclick: () => container.removeChild(itemDiv)
        })
      ]);
      container.appendChild(itemDiv);
    }

    // --- GENERATE CONFIG ---
    function generateConfig() {
      // Header
      const headerType = document.querySelector('input[name="headerType"]:checked').value;
      const header = headerType === 'text'
        ? { type: 'text', text: document.getElementById('headerTextValue').value.trim(), logoFilename: '' }
        : { type: 'logo', text: '', logoFilename: document.getElementById('headerLogoFile').value.trim() };

      // Tagline
      const tagline = document.getElementById('tagline').value.trim();

      // Sections
      const sections = Array.from(document.querySelectorAll('#sectionsContainer .section-block')).map(sectionDiv => {
        const inputs = sectionDiv.querySelectorAll('input');
        const id = inputs[0].value.trim() || 'section-' + Date.now();
        const name = inputs[1].value.trim() || 'Tanpa Nama';

        const items = Array.from(sectionDiv.querySelectorAll('.menu-items .menu-item')).map(itemDiv => {
          const [nameInp, descInp, imgInp, priceInp] = itemDiv.querySelectorAll('input, textarea');
          return {
            id: nameInp.value.trim().toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, ''),
            name: nameInp.value.trim(),
            description: descInp.value.trim(),
            imageFilename: imgInp.value.trim(),
            price: Number(priceInp.value) || 0
          };
        }).filter(item => item.name); // Only include items with a name

        return { id, name, items };
      }).filter(section => section.name); // Only include sections with a name

      // Extra Images
      const extraImages = Array.from(document.querySelectorAll('#extraImagesContainer input'))
        .map(inp => inp.value.trim())
        .filter(v => v !== '');

      // Contact
      const contact = {
        address: document.getElementById('address').value.trim(),
        whatsapp: document.getElementById('whatsapp').value.trim()
      };

      // Social Media
      const socialMedia = {
        instagram: document.getElementById('ig').value.trim(),
        facebook: document.getElementById('fb').value.trim(),
        youtube: document.getElementById('yt').value.trim(),
        twitter: document.getElementById('tw').value.trim()
      };

      // Build config
      const config = {
        header,
        tagline,
        sections,
        extraImages,
        contact,
        socialMedia
      };

      // Generate & download
      const jsContent = `const restaurantConfig = ${JSON.stringify(config, null, 2)};`;
      const blob = new Blob([jsContent], { type: 'application/javascript' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'config.js';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showStatus('File config.js berhasil diunduh!', 'success');
    }
  </script>
</body>
</html>